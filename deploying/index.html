<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
<script src="/init.js"></script><title data-react-helmet="true">Deploying | EmbraceSQL</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Deploying | EmbraceSQL"><meta data-react-helmet="true" name="description" content="Getting Started"><meta data-react-helmet="true" property="og:description" content="Getting Started"><meta data-react-helmet="true" property="og:url" content=" https://embracesql.github.io//deploying"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://embracesql.github.io//deploying"><link rel="stylesheet" href="/styles.ec5e3003.css">
<link rel="preload" href="/styles.dea9df53.js" as="script">
<link rel="preload" href="/runtime~main.feb29369.js" as="script">
<link rel="preload" href="/main.b2a2ed46.js" as="script">
<link rel="preload" href="/1.b02d4389.js" as="script">
<link rel="preload" href="/3.364d9a71.js" as="script">
<link rel="preload" href="/21.95640fc2.js" as="script">
<link rel="preload" href="/ec1ed54d.33c7e9ce.js" as="script">
<link rel="preload" href="/17896441.73950f02.js" as="script">
<link rel="preload" href="/35ade894.c91e500d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">EmbraceSQL</strong></a><a class="navbar__item navbar__link" href="/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/civitaslearning/embrace-sql" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_fulF"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_dww5 moon_1j_Y"></span></div><div class="react-toggle-track-x"><span class="toggle_dww5 sun_2wpk"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">EmbraceSQL</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/civitaslearning/embrace-sql" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2i-3"><div class="docSidebarContainer_1fXK" role="complementary"><div class="sidebar_1mEu"><div class="menu menu--responsive menu_dF3j"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_3FBP" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/index">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/databases">Databases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tables">Tables</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sqlmodules">SQL Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/security">Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/embedded">Embedded</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Workflow</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/configuration">Configuration</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/deploying">Deploying</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/events">Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/problems">Problems</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/interfaces">Interfaces</a></li></ul></li></ul></div></div></div><main class="docMainContainer_MhoH"><div class="container padding-vert--lg docItemWrapper_szZp"><div class="row"><div class="col docItemCol_J-FY"><div class="docItemContainer_3JPl"><article><header><h1 class="docTitle_3s2j">Deploying</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2PJb" id="getting-started"></a>Getting Started<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h2><p>Embrace SQL lets you package itself, the server, along with your configuration, custom SQL, and handlers with one command:</p><div class="mdxCodeBlock_2nhA"><div class="codeBlockContent_1Q9p"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1sH4">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_x6MH"><div class="codeBlockLines_3t2l" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run embrace-sql build my-embrace-sql-image</span></div></div></div></div></div><p>This will take the core EmbraceSQL server container, and overlay the current directory into a new Docker image.
From there you can push your image to any container registry or hosting tool you like, as well as convert from Docker to other container formats.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2PJb" id="online-versioning"></a>Online Versioning<a aria-hidden="true" tabindex="-1" class="hash-link" href="#online-versioning" title="Direct link to heading">#</a></h2><p>Dev/Test/Stage as well as beta testing can be a challenge, so Embrace SQL provides out of the box support for versioned APIs. When your local directory is a Git repository, Embrace SQL has the ability to let you run any branch, tag, or SHA for any given query.</p><p>You can do this on the fly with REST by appending <code>#branch</code> or <code>#tag</code> or <code>#sha</code> to the end of an URL.</p><p>Similarly in code, in a handler, say you want to set all queries to be served from the <code>stage</code> branch, which means the most recent commit on this branch.</p><div class="mdxCodeBlock_2nhA"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3v07">./before.js</div><div class="codeBlockContent_1Q9p"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1sH4 undefined">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_x6MH codeBlockWithTitle_2Fxs"><div class="codeBlockLines_3t2l" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">before</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">version</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stage&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>You can get pretty creative with these handlers, and set the version based on the user token, or environment variables, or even rest calls to external confguration services.</p><p>Internally EmbraceSQL uses Git to checkout and cache requested versions and dynamically sets itself up to process SQL modules with the SQL and handlers specified at that version. Separate event queues and handler registrations are used for each version, so there is no risk of mismatch between your SQL and your handlers.</p><p>Care must be taken that your database won&#x27;t have branch schema capability -- unfortunately such a thing does not yet exist.
To make working with versioned code easier, Embrace SQL knows which migrations are logically with a given branch/tag/sha and will warn you if they are not applied.
Even smarter -- EmbraceSQL, for each database, for each schema, keeps track of the schema after each migration and will warn you if the schema does no match the expectations, and raise and event containing the schema diff.
Embrace SQL will still try to run your SQL modules even if there is a mismatch, but having the mismatch schema output will greatly aid your comfort with versioning.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2PJb" id="logging"></a>Logging<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logging" title="Direct link to heading">#</a></h2><p>EmbraceSQL writes out informative messages to <code>stdout</code> and error messages to <code>stderr</code>. Every message is written as a single line JSON with escaped linefeeds in an attempt to make the logs easier to parse and process with your favoite log and event management tool.</p><p>Four log levels are enumerated: <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2PJb" id="metrics"></a>Metrics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#metrics" title="Direct link to heading">#</a></h2><p>EmbraceSQL exports metrics in Prometheus format at a well known URL <code>http://server:port/metrics</code>. In addition to default Prometheus metrics, you will find:</p><ul><li>Per SQL Module<ul><li>Counters for every event</li><li>Histogram for every event handler run duration</li></ul></li><li>Per Database<ul><li>Counters for every event</li><li>Histogram for every event handler run duration</li></ul></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/civitaslearning/embrace-sql/edit/master/docs/deploying.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/events"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Events »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_wfLO"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started" class="table-of-contents__link">Getting Started</a></li><li><a href="#online-versioning" class="table-of-contents__link">Online Versioning</a></li><li><a href="#logging" class="table-of-contents__link">Logging</a></li><li><a href="#metrics" class="table-of-contents__link">Metrics</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright © 2020 Civitas Learning, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.dea9df53.js"></script>
<script src="/runtime~main.feb29369.js"></script>
<script src="/main.b2a2ed46.js"></script>
<script src="/1.b02d4389.js"></script>
<script src="/3.364d9a71.js"></script>
<script src="/21.95640fc2.js"></script>
<script src="/ec1ed54d.33c7e9ce.js"></script>
<script src="/17896441.73950f02.js"></script>
<script src="/35ade894.c91e500d.js"></script>
</body>
</html>