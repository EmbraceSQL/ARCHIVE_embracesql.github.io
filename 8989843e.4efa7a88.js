(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{150:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return s})),a.d(t,"metadata",(function(){return o})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return b}));var n=a(1),r=a(9),i=(a(0),a(159)),s={title:"Tables"},o={id:"tables",title:"Tables",description:"## Getting Started",source:"@site/docs/tables.mdx",permalink:"/tables",editUrl:"https://github.com/civitaslearning/embrace-sql/edit/master/docs/tables.mdx",sidebar:"someSidebar",previous:{title:"Databases",permalink:"/databases"},next:{title:"SQL Modules",permalink:"/sqlmodules"}},l=[{value:"Getting Started",id:"getting-started",children:[]},{value:"Migrations",id:"migrations",children:[]},{value:"Migrations and Multiple Databases",id:"migrations-and-multiple-databases",children:[]},{value:"Sharing Migrations",id:"sharing-migrations",children:[]}],c={rightToc:l};function b(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"getting-started"},"Getting Started"),Object(i.b)("p",null,"You can create tables in your database however you like, and EmbraceSQL will scan your database schema to reconfigure against that database. But, it's really handy to have a managed system of updating your database, and sticking with the name, we will embrace SQL."),Object(i.b)("p",null,"EmbraceSQL supports SQL script based migrations, against multiple databases, manages those migrations, and is smart enough to know when your schema and your SQL might be out of synch."),Object(i.b)("h2",{id:"migrations"},"Migrations"),Object(i.b)("p",null,"Create your first migration, which can actually be any SQL script you like, using the native syntax for your database. We\u2019re working on our embracesql.db demo, which is SQLite, so we\u2019ll create a file example for it. Copy and paste this:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sql",metastring:'title="migrations/default/001.sql"',title:'"migrations/default/001.sql"'}),"CREATE TABLE things(\n  id integer PRIMARY KEY,\n  name text NOT NULL\n);\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sql",metastring:'title="migrations/default/002.sql"',title:'"migrations/default/002.sql"'}),'INSERT INTO things(id, name) values(1, "planes");\nINSERT INTO things(id, name) values(2, "trains");\n')),Object(i.b)("p",null,"Notice the 001 -- that\u2019s just one way of doing it, but know that EmbraceSQL runs migrations in file name order, per named database. To run a migration, run this in your shell."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"docker run -v ${PWD}:/var/embracesql embracesql/server migrate\n")),Object(i.b)("h2",{id:"migrations-and-multiple-databases"},"Migrations and Multiple Databases"),Object(i.b)("p",null,"You can have database specific migrations by simply making a folder for each database, with sql inside. Let\u2019s have our ",Object(i.b)("inlineCode",{parentName:"p"},"other")," database be different."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yml",metastring:'title="embracesql.yaml"',title:'"embracesql.yaml"'}),"databases:\n  default: sqlite:embracesql.db\n  other: sqlite:other.db\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sql",metastring:'title="migrations/other/001.sql:"',title:'"migrations/other/001.sql:"'}),"CREATE TABLE strings(\n  string text PRIMARY KEY\n);\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sql",metastring:'title="migrations/other/002.sql:"',title:'"migrations/other/002.sql:"'}),'INSERT INTO strings(string) VALUES("hello world");\n')),Object(i.b)("p",null,"Run the migration. Note that you'll need to have an ",Object(i.b)("inlineCode",{parentName:"p"},"other")," database set up as described in ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"./databases"}),"Databases"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"docker run -v ${PWD}:/var/embracesql embracesql/server migrate\n")),Object(i.b)("p",null,"You can run migrations at any time. EmbraceSQL is just smart enough to detect if the needed migrations have been run on the target database, and will warn you if they have not. EmbraceSQL will still start -- but it\u2019s possible that some of your APIs won\u2019t do what you expect if part of your database is missing!"),Object(i.b)("h2",{id:"sharing-migrations"},"Sharing Migrations"),Object(i.b)("p",null,"Let's say you have a sharded database, and need to create the same table multiple times. EmbraceSQL makes this easy, simply create a folder under ",Object(i.b)("inlineCode",{parentName:"p"},"./migrations/")," for each database and make a symbolic link to share SQL files containing migrations."),Object(i.b)("p",null,"Databases and tables are great, but you need to be able to wire them into applications, which is the role of ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"./sqlmodules"}),"SQL Modules"),"."))}b.isMDXComponent=!0},159:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return p}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=r.a.createContext({}),b=function(e){var t=r.a.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o({},t,{},e)),a},u=function(e){var t=b(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=Object(n.forwardRef)((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=b(a),d=n,p=u["".concat(s,".").concat(d)]||u[d]||m[d]||i;return a?r.a.createElement(p,o({ref:t},c,{components:a})):r.a.createElement(p,o({ref:t},c))}));function p(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,s=new Array(i);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:n,s[1]=o;for(var c=2;c<i;c++)s[c]=a[c];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);